<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TfL Live Bus & Tube Finder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
  <style>
    :root {
      --bus-pill-bg: #dc2626;
      /* red-600 */
      --warning-color: #ffc107;
      /* Amber */
    }

    /* Main content padding */
    main {
      --pico-block-spacing-vertical: 0.25rem;
      padding-top: var(--pico-block-spacing-vertical);
      padding-bottom: 2rem;
    }

    /* Footer styling */
    footer {
      font-size: 0.75rem;
      padding: 0.75rem;
      text-align: center;
      border-top: var(--pico-border-width) solid var(--pico-muted-border-color);
      margin-top: 2rem;
    }

    .footer-options {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }

    /* Stop Card styling */
    .stop-card {
      margin-bottom: 1rem;
    }

    .stop-card>header {
      /* Use > to avoid selecting headers in nested articles if they are used */
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      border-bottom: 2px solid var(--pico-muted-border-color);
      padding: 0.5rem;
      /* Consistent padding */
    }

    .stop-card hgroup {
      margin-bottom: 0;
    }

    .stop-letter-badge {
      font-size: 0.8rem;
      background-color: var(--bus-pill-bg);
      color: white;
      margin-left: 0.5rem;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      border: none;
      width: 1.8rem;
      height: 1.8rem;
      border-radius: 50%;
    }

    .direction-badge {
      font-size: 0.7rem;
      background-color: var(--pico-muted-border-color);
      color: var(--pico-muted-color);
      padding: 0.15rem 0.4rem;
      border-radius: var(--pico-border-radius);
      margin-left: 0.5rem;
      font-weight: bold;
      display: inline-block;
      vertical-align: middle;
    }

    /* Disruption Icon */
    .warning-icon {
      width: 1.1em;
      height: 1.1em;
      fill: var(--warning-color);
      margin-left: 0.5rem;
      vertical-align: text-bottom;
      flex-shrink: 0;
    }

    /* Consistent arrivals list styling */
    .arrivals-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    /* Arrival item styling */
    .arrival-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0.5rem;
      /* Reduced vertical padding */
    }

    .arrival-item:not(:last-child) {
      border-bottom: 1px solid var(--pico-muted-border-color);
    }

    /* Remove bottom border for last item inside a destination group */
    .tube-destination-group .arrivals-list .arrival-item:last-child {
      border-bottom: none;
    }

    .arrival-details {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      overflow: hidden;
      /* For truncation */
      flex-grow: 1;
    }

    .truncate {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .bus-route {
      background-color: var(--bus-pill-bg);
      color: white;
      padding: 0.15rem 0.5rem;
      border-radius: var(--pico-border-radius);
      font-weight: bold;
      font-size: 0.8em;
      text-align: center;
      min-width: 3rem;
      flex-shrink: 0;
    }

    .arrival-time {
      font-weight: bold;
      font-size: 1rem;
      flex-shrink: 0;
      margin-left: 0.75rem;
    }

    /* Error display styling */
    .error-display {
      border-color: var(--pico-color-red-500);
      background-color: rgba(255, 0, 0, 0.1);
    }

    .error-display strong {
      color: var(--pico-color-red-500);
    }

    /* No buses/arrivals message */
    .no-arrivals-msg {
      text-align: center;
      padding: 0.5rem;
      /* Reduced padding */
      margin: 0;
      font-size: 0.9rem;
      color: var(--pico-muted-color);
    }

    .no-arrivals-msg p {
      margin: 0;
    }

    /* Tube Line Pill */
    .line-pill {
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: var(--pico-border-radius);
      font-weight: bold;
      font-size: 0.9em;
      text-align: center;
      flex-shrink: 0;
    }

    /* Tube Destination Grouping */
    .tube-destination-group {
      padding-top: 0;
      /* Removed padding */
    }

    .tube-destination-group:not(:first-child) {
      border-top: 1px dashed var(--pico-muted-border-color);
    }

    .tube-destination-header {
      font-size: 0.9em;
      font-weight: bold;
      background-color: var(--pico-muted-background-color);
      padding: 0.25rem 0.5rem;
      margin: 0;
    }

    /* Official TfL Line Colours */
    .line-bakerloo {
      background-color: #B36305;
    }

    .line-central {
      background-color: #E32017;
    }

    .line-circle {
      background-color: #FFD300;
      color: black;
    }

    .line-district {
      background-color: #00782A;
    }

    .line-hammersmith-city,
    .line-hammersmith-and-city {
      background-color: #F3A9BB;
      color: black;
    }

    .line-jubilee {
      background-color: #A0A5A9;
    }

    .line-metropolitan {
      background-color: #9B0056;
    }

    .line-northern {
      background-color: #000000;
      border: 1px solid white;
    }

    .line-piccadilly {
      background-color: #003688;
    }

    .line-victoria {
      background-color: #0098D4;
    }

    .line-waterloo-city,
    .line-waterloo-and-city {
      background-color: #95CDBA;
      color: black;
    }

    .line-elizabeth-line {
      background-color: #6950a1;
    }

    .line-dlr {
      background-color: #00A4A7;
    }

    .line-london-overground {
      background-color: #EE7C0E;
    }

    .line-trams {
      background-color: #84B817;
    }

    /* Header & Toolbar */
    header.container {
      --pico-nav-element-spacing-vertical: 0.25rem;
      padding-top: var(--pico-nav-element-spacing-vertical);
      padding-bottom: var(--pico-nav-element-spacing-vertical);
      margin-bottom: 0;
      display: flex;
      justify-content: flex-end;
      /* Align button to the right */
    }

    header nav ul li {
      padding: 0;
      margin-left: 0.5rem;
    }

    header nav {
      width: auto;
      /* Allow nav to shrink */
    }

    header nav ul {
      margin-bottom: 0;
    }

    #refresh-button,
    #location-button {
      padding: var(--pico-nav-element-spacing-vertical) 0.5rem;
      border: none;
      background: transparent;
      color: var(--pico-color);
      display: flex;
      align-items: center;
      justify-content: center;
      width: auto;
    }

    #refresh-button:focus,
    #location-button:focus {
      box-shadow: none;
    }

    .refresh-icon {
      width: 1.5rem;
      height: 1.5rem;
      fill: currentColor;
    }

    .spinning {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="icon-warning" viewBox="0 0 24 24">
      <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
    </symbol>
    <symbol id="icon-refresh" viewBox="0 0 24 24">
      <path
        d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
    </symbol>
    <symbol id="icon-map-pin" viewBox="0 0 24 24">
      <path
        d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
    </symbol>
  </svg>

  <header class="container">
    <nav>
      <ul>
        <li>
          <button id="location-button" aria-label="Refresh Location">
            <svg class="refresh-icon">
              <use href="#icon-map-pin"></use>
            </svg>
          </button>
        </li>
        <li>
          <button id="refresh-button" aria-label="Refresh Data">
            <svg class="refresh-icon">
              <use href="#icon-refresh"></use>
            </svg>
          </button>
        </li>
      </ul>
    </nav>
  </header>

  <main id="content-container" class="container">
    <!-- Dynamic content will be injected here -->
  </main>

  <footer>
    <details>
      <summary>API Settings</summary>
      <label for="tfl-api-key">TfL API Key</label>
      <input type="password" id="tfl-api-key" name="tfl-api-key" placeholder="Enter your TfL API key">
      <small>Your key is saved in your browser's local storage.</small>
    </details>
  </footer>

  <script type="module" src="index.js"></script>
</body>

</html>